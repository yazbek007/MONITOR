<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙˆØª Ø§Ù„ØªÙ†ÙÙŠØ°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨ÙˆØª Ø§Ù„ØªÙ†ÙÙŠØ°</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ” ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„</h5>
                    </div>
                    <div class="card-body">
                        <button id="checkConnection" class="btn btn-primary mb-3">
                            ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¨ÙˆØª Ø§Ù„ØªÙ†ÙÙŠØ°
                        </button>
                        <div id="connectionResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</h5>
                    </div>
                    <div class="card-body">
                        <button id="sendTest" class="btn btn-success mb-3">
                            Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
                        </button>
                        <div id="testResult" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„</h5>
            </div>
            <div class="card-body">
                <div id="logContainer" style="max-height: 300px; overflow-y: auto;">
                    <!-- Ø§Ù„Ø³Ø¬Ù„ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const badgeClass = type === 'error' ? 'bg-danger' : 
                              type === 'success' ? 'bg-success' : 'bg-secondary';
            
            const logEntry = `
                <div class="alert alert-${type === 'error' ? 'danger' : 
                                      type === 'success' ? 'success' : 'info'} 
                            alert-dismissible fade show" role="alert">
                    <span class="badge ${badgeClass} me-2">${timestamp}</span>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            logContainer.innerHTML = logEntry + logContainer.innerHTML;
        }
        
        document.getElementById('checkConnection').addEventListener('click', async () => {
            const btn = document.getElementById('checkConnection');
            btn.disabled = true;
            btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
            
            addLog('Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¨ÙˆØª Ø§Ù„ØªÙ†ÙÙŠØ°...');
            
            try {
                const response = await fetch('/api/check_executor_connection');
                const result = await response.json();
                
                let html = '<div class="alert alert-' + (result.success ? 'success' : 'danger') + '">';
                html += '<h6>' + (result.success ? 'âœ… Ù†Ø¬Ø­ Ø§Ù„ÙØ­Øµ' : 'âŒ ÙØ´Ù„ Ø§Ù„ÙØ­Øµ') + '</h6>';
                html += '<p>' + result.message + '</p>';
                
                if (result.steps) {
                    html += '<ul class="mb-0">';
                    result.steps.forEach(step => {
                        html += '<li>' + step + '</li>';
                    });
                    html += '</ul>';
                }
                
                html += '</div>';
                
                document.getElementById('connectionResult').innerHTML = html;
                addLog(result.message, result.success ? 'success' : 'error');
                
            } catch (error) {
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ” ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„';
            }
        });
        
        document.getElementById('sendTest').addEventListener('click', async () => {
            const btn = document.getElementById('sendTest');
            btn.disabled = true;
            btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            addLog('Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ...');
            
            try {
                const response = await fetch('/api/test_executor_notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                let html = '<div class="alert alert-' + (result.success ? 'success' : 'danger') + '">';
                html += '<h6>' + (result.success ? 'âœ… Ù†Ø¬Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' : 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„') + '</h6>';
                html += '<p>' + result.message + '</p>';
                
                if (result.response_time) {
                    html += '<p><strong>â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ' + result.response_time + '</p>';
                }
                
                if (result.status_code) {
                    html += '<p><strong>ğŸ“Š ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ' + result.status_code + '</p>';
                }
                
                html += '</div>';
                
                document.getElementById('testResult').innerHTML = html;
                addLog(result.message, result.success ? 'success' : 'error');
                
            } catch (error) {
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: ' + error, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ';
            }
        });
    </script>
</body>
</html>
